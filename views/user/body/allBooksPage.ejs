<% if(title === 'Books'){ %>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active">Books</li>
        </ol>
    </nav>
<% } %>

<style>
.book-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    border: none;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.book-card:hover {
    transform: translateY(-8px) rotateY(-5deg);
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.book-cover-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    margin: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    box-shadow: 
        -3px 0 8px rgba(0,0,0,0.15),
        0 2px 10px rgba(0,0,0,0.1),
        inset -2px 0 4px rgba(0,0,0,0.1);
}

.book-cover-wrapper::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 6px;
    height: 100%;
    background: linear-gradient(180deg, 
        rgba(0,0,0,0.2) 0%, 
        rgba(0,0,0,0.1) 50%, 
        rgba(0,0,0,0.2) 100%);
    z-index: 2;
}

.book-cover-wrapper::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 0;
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, 
        rgba(255,255,255,0.4) 0%, 
        rgba(255,255,255,0.2) 50%, 
        rgba(255,255,255,0.4) 100%);
    z-index: 3;
}

.book-card img {
    transition: transform 0.3s ease;
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 6px;
    position: relative;
    z-index: 1;
}

.book-card:hover img {
    transform: scale(1.02);
}

.book-card:hover .book-cover-wrapper {
    box-shadow: 
        -5px 0 15px rgba(0,0,0,0.25),
        0 5px 20px rgba(0,0,0,0.15),
        inset -3px 0 6px rgba(0,0,0,0.15);
}

.filter-section {
    background: linear-gradient(135deg, #f9f2e4 0%, #f9f2e4 100%);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.price-input {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 8px 12px;
    transition: border-color 0.3s ease;
}

.price-input:focus {
    border-color: #439158;
    box-shadow: 0 0 0 0.2rem rgba(56, 111, 80, 0.25);
}

.filter-btn {
    background: linear-gradient(135deg, #edcd2f 0%, #edcd2f 100%);
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    background: linear-gradient(135deg, #ede04e 0%, #e9df6d 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(237, 205, 47, 0.3);
}

.clear-btn {
    background: linear-gradient(135deg, #669ec4 0%, #669ec4 100%);
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
}

.clear-btn:hover {
    background: linear-gradient(135deg, #479bd3 0%, #2e8ece 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 158, 196, 0.3);
}

.sort-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 8px 12px;
    transition: border-color 0.3s ease;
}

.sort-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .book-card {
        width: 10rem !important;
    }
    
    .book-card img {
        height: 160px;
    }
    
    .book-cover-wrapper {
        margin: 10px;
    }
    
    .book-card:hover {
        transform: translateY(-5px) rotateY(-2deg);
    }
}

@media (max-width: 576px) {
    .book-card {
        width: 9rem !important;
    }
    
    .book-card img {
        height: 140px;
    }
    
    .book-cover-wrapper {
        margin: 8px;
    }
}
</style>

<!-- Filter and Sort Section -->
<div class="filter-section">
    <form id="filterForm" method="GET" action="/books">
        <div class="row align-items-end">
            <div class="col-md-3">
                <label for="sortBy" class="form-label fw-bold text-dark">
                    <i class="bi bi-sort-down me-1"></i>Sort by
                </label>
                <select class="form-select sort-select" id="sortBy" name="sortBy">
                    <option value="price_low" <%= currentSort === 'price_low' ? 'selected' : '' %>>Price (Low to High)</option>
                    <option value="price_high" <%= currentSort === 'price_high' ? 'selected' : '' %>>Price (High to Low)</option>
                    <option value="rating_high" <%= currentSort === 'rating_high' ? 'selected' : '' %>>Rating (High to Low)</option>
                    <option value="rating_low" <%= currentSort === 'rating_low' ? 'selected' : '' %>>Rating (Low to High)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="minPrice" class="form-label fw-bold text-dark">
                    <i class="bi bi-currency-dollar me-1"></i>Min Price (৳)
                </label>
                <input type="number" class="form-control price-input" id="minPrice" name="minPrice" 
                       placeholder="0" min="0" step="1" value="<%= currentMinPrice || '' %>">
            </div>
            <div class="col-md-3">
                <label for="maxPrice" class="form-label fw-bold text-dark">
                    <i class="bi bi-currency-dollar me-1"></i>Max Price (৳)
                </label>
                <input type="number" class="form-control price-input" id="maxPrice" name="maxPrice" 
                       placeholder="10000" min="0" step="1" value="<%= currentMaxPrice || '' %>">
            </div>
            <div class="col-md-3">
                <div class="d-flex gap-2">
                    <button type="submit" class="btn filter-btn flex-fill">
                        <i class="bi bi-funnel-fill me-1"></i>Filter
                    </button>
                    <a href="/books" class="btn clear-btn">
                        <i class="bi bi-x-circle me-1"></i>Clear
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<h6>(Showing <%=start+1%> to <%=start+books.length%> of <%=cnt%> books)</h6>
<div class="d-flex flex-wrap justify-content-evenly">
    <% for(let i = 0;i < books.length;i++){ %>

    <div class="card book-card mb-1 m-1" style="width: 12rem;">
        <div class="book-cover-wrapper">
            <img class="card-img-top" src="<%= books[i].image %>" alt="<%= books[i].name %>">
        </div>
        <div class="card-body" style="display: flex;flex-direction: column;justify-content:space-between;">
            <p style="color: #266dd3;font-weight: 650; font-size: 18px;" class="card-title"><%= books[i].name %></p>
            <div>
                <span class="ml-0">
                    <%if(books[i].review_count){%>
                        <% for(let stars = 0; stars < Math.round(parseFloat(books[i].star)); stars++){ %>
                            ⭐
                        <% } %>
                    <%}else{%>
                        No Reviews yet
                    <%}%>
                </span>
                <p class="card-text">Price: Tk. <%= books[i].price %></p>
                <% if(books[i].stock > 0){ %>
                    <small class="text-success mb-2"><i class="bi bi-check-circle"></i> In Stock</small>
                <% }else{ %>
                    <span class="badge bg-danger text-white mb-2 d-inline-flex align-items-center" style="font-size: 11px; padding: 4px 8px;">
                        <i class="bi bi-exclamation-triangle-fill me-1"></i> Out of Stock
                    </span>
                <% } %>
                <div class="d-grid gap-2">
                    <a href=<%="/books/"+books[i].id%> class="btn btn-warning">
                    <i class="bi bi-book-half"></i>
                    VIEW BOOK
                    </a>
                </div>
            </div>
        </div>
    </div>

    <% } %>
    <br/>

</div>
<div style="margin: auto" id="paginationDiv" data-pages="<%=pages%>" data-page="<%=page%>"
     data-href="<%=target%>" data-query="<%=queryString%>"></div>
<script async src="/scripts/pagination.js?v=5"></script>